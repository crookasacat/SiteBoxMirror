<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>SiteBoxMirror</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index, follow" />
    <meta name="description" content="SiteBoxMirror a jQuery wrapper for CodeMirror2" />
    <meta name="keywords" content="CodeMirror CodeMirror2 jQuery plugin" />
    
    <!-- css -->    
    <link type="text/css" rel="styleSheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/overcast/jquery-ui.css" />    
    
    <link type="text/css" rel="styleSheet" href="demo_assets/cmxformTemplate.css"  />
    <link type="text/css" rel="styleSheet" href="demo_assets/cmxform.css" /> 
    <link type="text/css" rel="styleSheet" href="demo_assets/demo_style.css" >
    
    <link type="text/css" rel="stylesheet" href="/CodeMirror2/ui/ui.css" /> 
    
    <!-- js -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js" ></script>
    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" ></script>
    <script type="text/javascript" src="demo_assets/cmxforms.js" ></script>
    
    <script src="jquery.SiteBoxMirror.js"></script >
    
  </head>
  <body>
    
    <div class="box blackBox">
      <h1 class="blackHeading">SiteBoxMirror a jQuery wrapper for CodeMirror2</h1>
      
      <h2>Overview</h2>  
      <p>
        As part of a wider project that entails online editing of html, css, javascript and mysql I 
        have developed this jQuey plugin to enable easy instalation of the codemirror 2 editor in my pages.<br />
        It's aim is to provide a lightweight frame around codemirror and make deployment quick and easy. 
      </p>
      <p>
        If my approach fits your needs feel free to use the plugin as it is or modify it to your own ends.
      </p>
      <p>
        The plugin wraps the codemirror editor in a frame and provides buttons for <b>Find &amp; Replace, 
        Indent Selection, Indent Document and FullScreen</b> Mode.
      </p>
      
      <p>
        See the <a href="#demo">demo</a>.
      </p>
      
      <h2>Known Issues</h2>
      <h4>Search not case insensitive if query starts with lowercase</h4>
      <p>
        My rewritten search extention <a href="search.js">ui/search.js</a> relies upon the original 
        <a href="../lib/util/searchcursor.js">searchcursor.js</a> code. This code finds "Search" with a query of "search".
      </p>
      <h4>Resize is clunky!</h4>
      <p>
        The resizing of the editor scroll area has taxed me. Use a max-width on the element that contains the editors and it seems to work!
      </p>
      <h4>Non IIS hosts need to change the extention of the dialoug url</h4>
      <p>
        The plugin loads its search dialoug via an ajax post. On my IIS server the extension must be a configured script type so I have used .aspx.
      </p>
      <p>
        Non IIS users can rename <a href="search.aspx">ui/search.aspx</a> to somthing more appropriate and supply 
        the new name via config or at create time. (assuming dynamic setup) <br />
        Alternatively you can edit the property <b>$.fn.SiteBoxMIRROR.frame.searchUrl</b> property in 
        <a href="jquery.SiteBoxMirror.js">ui/jquery.SiteBoxMirror.js</a>
      </p>
      <h4>mySql mode is custom</h4>
      <p>
        I am using my own mysql mode that predates the one now available.<br />
        To use the standard mysql mode change the <b>$.fn.SiteBoxMIRROR.jsLib.mysql</b> property in 
        <a href="jquery.SiteBoxMirror.js">ui/jquery.SiteBoxMirror.js</a> or pass the new name via config or at create time. (assuming dynamic setup) 
      </p>
      
      <h2>Dependencies</h2>
      <p>
        As this is a jQuery plugin you need jQuery. 
        <br />
        This demo uses the google CDN for jQuery:
      </p>
      <ul>
        <li>
          <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js">
            https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js
          </a>
        </li>
        <li>
          <a href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js">
            https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js
          </a>
        </li>
        <li>
          <a href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/overcast/jquery-ui.css">
            https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/overcast/jquery-ui.css
          </a>
        </li>
      </ul>
      <br />
      <p>
        And you need <a href="http://codemirror.net/">CodeMirror</a> of course.
      </p>
      
      <h2>Installation</h2>
      <div>
        <img src="demo_assets/folder_structure.png" alt="folder structure" style="width:207; height:360;float:left"/>
        <h4>Folder structure</h4>
        <p>
          The plugin is designed to be hosted in a sub folder of the codemirror2 tree called ui/.
        </p>
        <p> 
          The default installation assumes that the codemirror folder is a child of the web root as in the diagram to the left.
        </p>
        <h4>Step 1 - Get CodeMirror2</h4>
        <p>
          Get a copy of <a href="http://codemirror.net/">CodeMirror2</a> and install it into your site.
        </p>
        <p> 
          I suggest using a folder name of <b>CodeMirror2</b> off your web root.
        </p>
        <h4>Step 2 - Add SiteBoxMirror to CodeMirror tree</h4>
        <p>
          Download <a href="SiteBoxMirror.zip">SiteBoxMirror.zip</a> and add the ui folder contained therein to the CodeMirror2 tree.
        </p>
        <h4>Step 3 - Validate Install</h4>
        <p>
          If all is well you should be able to view a copy of this page <b>/CodeMirror2/ui/index.html</b> on your website.
        </p>

        <br style="clear:left" />
      </div>
      
      <h3>Your page requires one of the following configurations</h3>
      
      <h4>Minimum config</h4>
      <p>
        As a bare minimum your page must include jQuery jQueryUi and the plugin file <a href="/CodeMirror2/ui/jquery.SiteBoxMirror.js">jquery.SiteBoxMirror.js</a>  
      </p>
      <pre class="docs_htm">
&lt;link type="text/css" href="path_to_jquery-ui.css" rel="styleSheet"/&gt;
&lt;script type="text/javascript" src="path_to_jquery.min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="path_to_jquery-ui.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="jquery.SiteBoxMirror.js"&gt;&lt;/script&gt;
</pre>
      
      <p>
        In this configuration, the plugin will attempt to load all dependant scripts and css. It will work in most browsers but might be ugly!
      </p>
      <h4>Better config (development)</h4>
      <p>
        The plugin will work better on most browsers if you also specify the <a href="/CodeMirror2/ui/ui.css">/CodeMirror2/ui/ui.css</a> file 
      </p>
    <pre class="docs_htm">
&lt;link type="text/css" href="path_to_jquery-ui.css" rel="styleSheet"/&gt;
&lt;link type="text/css" href="/CodeMirror2/ui/ui.css" rel="styleSheet"/&gt;

&lt;script type="text/javascript" src="path_to_jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="path_to_jquery-ui.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="jquery.SiteBoxMirror.js"&gt;&lt;/script&gt;
</pre>
      <p>In this configuration only the required javascripts are added to the document. This is the prefered configuration while developing the plugin.</p>
      <h4>Best config (production)</h4>
      <p>
      Finally the best configuration is to use the standalone minified version 
      <a href="jquery.SiteBoxMirror.standalone.min.js">jquery.SiteBoxMirror.standalone.min.js</a>
      </p>
    <pre class="docs_htm">
&lt;link type="text/css" href="path_to_jquery-ui.css" rel="styleSheet"/&gt;
&lt;link type="text/css" href="/CodeMirror2/ui/ui.css" rel="styleSheet"/&gt;

&lt;script type="text/javascript" src="path_to_jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="path_to_jquery-ui.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="jquery.SiteBoxMirror.standalone.min.js"&gt;&lt;/script&gt;
</pre>
      <p>In this configuration all dependant scripts are included in the plug in so no lazy loading is required.</p>      
      
      <h2>Usage</h2>
      
      <h4>Convert a &lt;textarea&gt; into an editor with ui frame</h4>
      <pre class="docs_js">
$("#p_code1").SiteBoxMIRROR({ mode: "text/html"});</pre>      
      
      <h4>Highlight a &lt;pre&gt;</h4>
      <pre class="docs_js">
$("#mysql-src").SiteBoxMIRROR("highlight", { mode: "text/x-mysql" });</pre>

      <h4>getCode from configured editor</h4>
      <pre class="docs_js">
$("#getBtn").click(function(){
  var code = $("textarea.cmui").SiteBoxMIRROR("getCode");
  alert(code);
});</pre>

      <h4>setCode of configured editor</h4>
      <pre class="docs_js">
$("#setBtn").click(function(){
  $("#p_code1").SiteBoxMIRROR("setCode", "Hello world!"); 
});</pre>

      <h4>destroy configured editor</h4>
      <pre class="docs_js">
$("textarea.cmui").SiteBoxMIRROR("destroy");</pre>

      <h2>Configurator methods</h2>
      <p>
        The plugin exposes 2 configuration helpers.
      </p>
      
      <h4>$.fn.SiteBoxMIRROR.SetConfig()</h4>
      <p>Use this to set plugin defaults. Properties set this way affect all instances created after the setter is executed.
      <pre class="docs_js">
$.fn.SiteBoxMIRROR.SetConfig({
  mirror : {
    mode         : "text/html",
    tabSize      : 2, 
    lineNumbers  : true
  }
});</pre>

      <h4>$.fn.SiteBoxMIRROR.GetConfig(format)</h4>
      <p>Use this to get plugin defaults. The config object is returned as an object or JSON depending on format.
      <pre class="docs_js">
$("#config").text($.fn.SiteBoxMIRROR.GetConfig("json"));

$("#config").text($.fn.SiteBoxMIRROR.GetConfig("object"));</pre>
      <h4>jquery.SiteBoxMirror.standalone.min.js Config (json)</h4>
      <pre id="config"></pre>
      
      <h2>Compression helper</h2>      
      <p>
        Included in the package is a <a href="compress.htm">very simple compression helper</a> that creates 
        a standalone minified version of the current plugin config. 
        This will NOT work on your server, unless you are using siteBox, but it may help with your own solution.<br />
        see <a href="http://yuicompressor.codeplex.com/">http://yuicompressor.codeplex.com/</a>
      </p>
    </div>
    
    <script type="text/javascript">
        $("pre.docs_htm").SiteBoxMIRROR("highlight", { mode: "text/html" });
        $("pre.docs_js").SiteBoxMIRROR("highlight", { mode: "text/javascript" });
        $("#config").text($.fn.SiteBoxMIRROR.GetConfig("json"));
        $("#config").SiteBoxMIRROR("highlight", { mode: "text/javascript" });
    </script>
    
    <div id="demo" class="box blackBox" style="max-width:1000px">
<h1 class="blackHeading">SiteBoxMirror Demo</h1> 
<div>
  <a href="#uiToggleBtn" class="btn" id="uiToggleBtn">destroy</a>
  <a href="#set" class="btn" id="setBtn">setcode</a>
  <a href="#get" class="btn" id="getBtn">getcode</a>
  
</div>
<form id="cmTest" class="cmxform" action="?" method="post" style="width:auto">
  <fieldset>
    <legend>
      SiteBoxMirror Demo
    </legend>
    <div style="max-width:980px">
      
      <label for="p_code1">html code(the demo div)</label>
      <textarea class="cmui" id="p_code1" name="p_code1" rows="10" cols="80"></textarea>
      
      <label for="p_code2">example css code</label>
      <textarea class="cmui" id="p_code2" name="p_code2" rows="10" cols="80"></textarea>
      
      <label for="p_code3">example js code</label>
      <textarea class="cmui" id="p_code3" name="p_code3" rows="10" cols="80"></textarea>
      
      <label for="p_code4">example msql code</label>
      <textarea class="cmui" id="p_code4" name="p_code4" rows="10" cols="80"></textarea>
      
    </div>
  </fieldset>
</form>

<script type="text/javascript">
  $(document).ready(function(){
    //load demo source code
    initsrc();
    
    //set up the codemirrors
    $("#p_code1").SiteBoxMIRROR({ mode: "text/html"});
    $("#p_code2").SiteBoxMIRROR({ mode: "text/css"});
    $("#p_code3").SiteBoxMIRROR({ mode: "text/javascript"});
    $("#p_code4").SiteBoxMIRROR({ mode: "text/x-mysql"}); 
    
    //toggle demo button
    $("#uiToggleBtn").click(function(){
      if($(this).text() == "destroy"){
        $("textarea.cmui").SiteBoxMIRROR("destroy");
        $(this).text("create");
      }
      else{
        $("#p_code1").SiteBoxMIRROR({ mode: "text/html"});
        $("#p_code2").SiteBoxMIRROR({ mode: "text/css"});
        $("#p_code3").SiteBoxMIRROR({ mode: "text/javascript"});
        $("#p_code4").SiteBoxMIRROR({ mode: "text/x-mysql"});
        $(this).text("destroy");
      }
    });
    //setcode demo button
    $("#setBtn").click(function(){
      $("#p_code1").SiteBoxMIRROR("setCode", demosrc.html);
      $("#p_code2").SiteBoxMIRROR("setCode", demosrc.css);
      $("#p_code3").SiteBoxMIRROR("setCode", demosrc.js);
      $("#p_code4").SiteBoxMIRROR("setCode", demosrc.sql); 
    });
    //getcode demo button
    $("#getBtn").click(function(){
      var code = $("textarea.cmui").SiteBoxMIRROR("getCode");
      alert(code);
    });
  });
  
  //demo source code for editors
  var demosrc = {
    html : "",
    css : "",
    js : "",
    sql : ""
  }
  function initsrc(){
    $("#p_code1").val( $("#demo").html().trim() );
    $("#htm-src").text($("#p_code1").val());
    $("#p_code2").val( $("#css-src").text() );
    $("#p_code3").val( $("#js-src").text() );
    $("#p_code4").val( $("#mysql-src").text() );
    
    demosrc.html = $("#htm-src").text();
    demosrc.css = $("#css-src").text();
    demosrc.js = $("#js-src").text();
    demosrc.sql = $("#mysql-src").text();
  }
</script>      
      
    </div>
       
    <pre id="htm-src" class="src"></pre>

    <pre id="css-src" class="src">
.form_rules{
  font-style=italic;
  float:right;
}

.form_errors{
  margin-bottom:10px;
  margin-left: 10px;
  border: 1px #993333 solid;
  padding:5px;
  width: 350px;
}</pre>

    <pre id="js-src" class="src">
// apply inline-box only for mozilla
if( jQuery.browser.mozilla ) {
  // do when DOM is ready
  $( function() {
    // search form, hide it, search labels to modify, filter classes nocmx and error
    $( 'form.cmxform' ).hide().find( 'p>label:not(.nocmx):not(.error)' ).each( function() {
      var $this = $(this);
      var labelContent = $this.html();
      var labelWidth = document.defaultView.getComputedStyle( this, '' ).getPropertyValue( 'width' );
      // create block element with width of label
      var labelSpan = $("&lt;span&gt;")
      .css("display", "block")
      .width(labelWidth)
      .html(labelContent);
      // change display to mozilla specific inline-box
      $this.css("display", "-moz-inline-box")
      // remove children
      .empty()
      // add span element
      .append(labelSpan);
      // show form again
    }).end().show();
  });
};</pre>

  <pre id="mysql-src" class="src">
DROP PROCEDURE IF EXISTS `rh_sp_test`$$
CREATE PROCEDURE `rh_sp_test`(
  IN SUS_ID VARCHAR(50),
  IN p_newimageName VARCHAR(128)
)
BEGIN

  DECLARE str_this_SpName VARCHAR(64);
  DECLARE int_id INT;

  SET str_this_SpName = 'rh_sp_clc_admin_pagebannerimage_NEW';

  CALL `rh_sp_sys_log_sp_call`(str_this_SpName);

  MAIN_BLOCK:BEGIN

    INSERT `rh_clc_pbi_pagebannerimage`(
      `clc_pbi_imageName`,
      `clc_pbi_status`
    )
    VALUES(
      'upload_pending.jpg',
      'INACTIVE'
    );

    SELECT LAST_INSERT_ID() INTO int_id;
  
    CALL `rh_sp_sys_SendUploadHint`(
      SUS_ID,
      'HTMLFORM',
      'p_newimageName',
      '/i/header_img/',
      'USE_ORIGINAL_FILENAME' 
    );

  END MAIN_BLOCK;
END $$
DELIMITER;</pre>
    
  </body>
</html>

