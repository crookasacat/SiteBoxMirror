<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>SiteBoxMirror</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index, follow" />
    <meta name="description" content="SiteBoxMirror a jQuery wrapper for CodeMirror2" />
    <meta name="keywords" content="CodeMirror CodeMirror2 jQuery plugin" />
    
    <!-- css -->    
    <link type="text/css" rel="styleSheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/overcast/jquery-ui.css"></link>    
    
    <link type="text/css" rel="styleSheet" href="demo_assets/cmxformTemplate.css"  />
    <link type="text/css" rel="styleSheet" href="demo_assets/cmxform.css" /> 
    <link type="text/css" rel="styleSheet" href="demo_assets/demo_style.css" />
    
    <link type="text/css" rel="stylesheet" href="/CodeMirror2/SiteBoxMirror/ui.css" /> 
    
    <!-- js -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js" ></script>
    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" ></script>
    <script type="text/javascript" src="demo_assets/cmxforms.js" ></script>
    
    <script type="text/javascript" src="jquery.SiteBoxMirror.js"></script >
    
  </head>
  <body>
    
    <div class="box blackBox">
      <h1 class="blackHeading">SiteBoxMirror a jQuery wrapper for CodeMirror2</h1>
      
      <h2>Overview</h2>  
      <p>
        As part of a wider project that entails online editing of html, css, javascript and mysql I 
        have developed this jQuey plugin to enable easy installation of the codemirror 2 editor in my pages.<br />
        It's aim is to provide a lightweight frame around codemirror and make deployment quick and easy. 
      </p>
      <p>
        If my approach fits your needs feel free to use the plugin as it is or modify it to your own ends.
      </p>
      <p>
        The plugin wraps the codemirror editor in a frame and provides buttons for <b>Find &amp; Replace, 
        Indent Selection, Indent Document and FullScreen</b> Mode.
      </p>
      
      <p>
        See the <a href="#demo">demo</a>.
      </p>
      
      <h2>Dependencies</h2>
      <p>
        As this is a jQuery plugin you need jQuery. 
        <br />
        This demo uses the google CDN for jQuery:
      </p>
      <ul>
        <li>
          <a href="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js">
            https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js
          </a>
        </li>
        <li>
          <a href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js">
            https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js
          </a>
        </li>
        <li>
          <a href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/overcast/jquery-ui.css">
            https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/overcast/jquery-ui.css
          </a>
        </li>
      </ul>
      <br />
      <p>
        And you need <a href="http://codemirror.net/">CodeMirror</a> of course.
      </p>
      
      <h2>Installation</h2>
      <div>
        <img src="demo_assets/folder_structure.png" alt="folder structure" style="width:207; height:360;float:left"/>
        <h4>Folder structure</h4>
        <p>
          The plugin as shipped is configured to be hosted in a sub folder of the <b>codemirror2</b> tree called <b>SiteBoxMirror</b>.
        </p>
        <p> 
          The default installation assumes that the codemirror2 folder is called <b>/codeMirror2/</b>is a child of the 
          web root as in the diagram to the left.
        </p>
        <h4>Step 1 - Get CodeMirror2</h4>
        <p>
          Get a copy of <a href="http://codemirror.net/">CodeMirror2</a> and install it into your site.
        </p>
        <p> 
          Install into folder <b>CodeMirror2</b> off your web root.
        </p>
        <h4>Step 2 - Add SiteBoxMirror to CodeMirror tree</h4>
        <p>
          SiteBoxMirror is hosted on Github at <a href="https://github.com/crookasacat/SiteBoxMirror">https://github.com/crookasacat/SiteBoxMirror</a> so 
          you can clone the repo.<br />
          Or you can  <a href="https://github.com/crookasacat/SiteBoxMirror/zipball/master">download a zip</a> of the latest version.
        </p>
        <p>
          Install into folder <b>SiteBoxMirror</b> off your <b>CodeMirror2</b> folder.
        </p>
        <h4>Step 3 - Validate Install</h4>
        <p>
          If all is well you should be able to view a copy of this page <b>/CodeMirror2/SiteBoxMirror/index.html</b> on your website.
        </p>

        <br style="clear:left" />
      </div>
      
      <h3>Your page requires one of the following configurations</h3>
      
      <h4>Minimum config (all css and js lazy loaded)</h4>
      <p>
        As a bare minimum your page must include jQuery jQueryUi and the plugin <a href="/CodeMirror2/SiteBoxMirror/jquery.SiteBoxMirror.js">jquery.SiteBoxMirror.js</a>  
      </p>
      <pre class="docs_htm">
&lt;link type="text/css" href="path_to_jquery-ui.css" rel="styleSheet"/&gt;
&lt;script type="text/javascript" src="path_to_jquery.min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="path_to_jquery-ui.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="/CodeMirror2/SiteBoxMirror/jquery.SiteBoxMirror.js"&gt;&lt;/script&gt;
</pre>
      <p>
        In this configuration, the plugin will lazy load all dependant scripts and css. 
        It will work in most browsers but might be ugly under some circumstances!
      </p>
      <h4>Better config (lazy load js only)</h4>
      <p>
        The plugin will work better on most browsers if you also specify the 
        <a href="/CodeMirror2/SiteBoxMirror/ui.css">/CodeMirror2/SiteBoxMirror/ui.css</a> file rather
        than letting the plugin lazyload it.
      </p>
    <pre class="docs_htm">
&lt;link type="text/css" href="path_to_jquery-ui.css" rel="styleSheet"/&gt;
&lt;link type="text/css" href="/CodeMirror2/SiteBoxMirror//ui.css" rel="styleSheet"/&gt;

&lt;script type="text/javascript" src="path_to_jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="path_to_jquery-ui.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="/CodeMirror2/SiteBoxMirror/jquery.SiteBoxMirror.js"&gt;&lt;/script&gt;
</pre>
      <p>
      In this configuration javascript dependencies are added to the document by the plugin. 
      Using this option any changes to external scripts may require the browser cache to be cleared
      before the changes are available to the plugin.</p>
      <h4>Best config (scripts combined and minified)</h4>
      <p>
      Finally the best configuration is to use the standalone minified version 
      <a href="jquery.SiteBoxMirror.standalone.min.js">jquery.SiteBoxMirror.standalone.min.js</a>
      </p>
    <pre class="docs_htm">
&lt;link type="text/css" href="path_to_jquery-ui.css" rel="styleSheet"/&gt;
&lt;link type="text/css" href="/CodeMirror2/SiteBoxMirror/ui.css" rel="styleSheet"/&gt;

&lt;script type="text/javascript" src="path_to_jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="path_to_jquery-ui.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="/CodeMirror2/SiteBoxMirror/jquery.SiteBoxMirror.standalone.min.js"&gt;&lt;/script&gt;
</pre>
      <p>
        In this configuration all dependant scripts are included in the plug in so no lazy loading is required, 
        however you must remember to update the component scripts to reflect any external changes if you want to be
        using the most up to date code from codemirror.
      </p> 
      
      <h4>Including dependent scripts manually and using additional modes</h4>
      <p>
        The plugin will not lazy load any scripts if it detects codemirror as it initializes, therefore if you wish to load the scripts
        from a tag in the head you are free to do so but you must load all the required scripts for the plugin to work.
      </p>
      <pre class="docs_htm">
&lt;link type="text/css" href="path_to_jquery-ui.css" rel="styleSheet"/&gt;

&lt;link type="text/css" href="/CodeMirror2/SiteBoxMirror/ui.css" rel="styleSheet"/&gt;

&lt;script type="text/javascript" src="path_to_jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="path_to_jquery-ui.min.js"&gt;&lt;/script&gt;
      
&lt;script type="text/javascript" src="/CodeMirror2/SiteBoxMirror/jquery.SiteBoxMirror.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/lib/codemirror.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/lib/util/searchcursor.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/SiteBoxMirror/search.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/lib/util/runmode.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/mode/css/css.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/mode/javascript/javascript.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/mode/xml/xml.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/mode/htmlmixed/htmlmixed.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/mode/xmlpure/xmlpure.js"&gt;&lt;/script&gt;,
&lt;script type="text/javascript" src="/CodeMirror2/SiteBoxMirror/mysql/mysql.js"&gt;&lt;/script&gt;      
</pre>
      <p>
        Additional parser modes can be loaded via a script tag and used via the mode option when creating an editor.
      </p>     
      
      <h2>Usage</h2>
      
      <h4>Convert a &lt;textarea&gt; into an editor with ui frame</h4>
      <pre class="docs_js">
$("#p_code1").SiteBoxMIRROR({ mode: "text/html"});</pre>
      <p>
        This happens :
      </p>
      <ul>
        <li>The text area ( p_code1 ) will be replaced with a wrapped codeMirror using the options specified.</li>
        <li>If the textarea ( p_code1 ) has an associated label ( using attribute <b>for</b> on label ) the text of the label is used as a title and the label is hidden.</li>
        <li>The width of editor is constrained by the flow of the document.</li>
        <li>The height of the codemirror itself will match the height of the textarea it replaces.</li>
        <li>NOTE The wrapped mirror block is display:block by default - adjust via css.</li>
        
      </ul>
      <h4>Highlight a &lt;pre&gt;</h4>
      <pre class="docs_js">
$("#mysql-src").SiteBoxMIRROR("highlight", { mode: "text/x-mysql" });</pre>

      <h4>getCode from configured editor</h4>
      <pre class="docs_js">
$("#getBtn").click(function(){
  var code = $("textarea.cmui").SiteBoxMIRROR("getCode");
  alert(code);
});</pre>

      <h4>setCode of configured editor</h4>
      <pre class="docs_js">
$("#setBtn").click(function(){
  $("#p_code1").SiteBoxMIRROR("setCode", "Hello world!"); 
});</pre>

      <h4>destroy configured editor</h4>
      <pre class="docs_js">
$("textarea.cmui").SiteBoxMIRROR("destroy");</pre>

      <h2>Configurator methods</h2>
      <p>
        The plugin exposes 2 configuration helpers.
      </p>
      
      <h4>$.fn.SiteBoxMIRROR.SetConfig()</h4>
      <p>
        Use this to set plugin defaults. Properties set this way affect all instances created after the setter is executed.
      </p>
      <pre class="docs_js">
$.fn.SiteBoxMIRROR.SetConfig({
  // set codemirror defaults to use
  mirror : {
    mode           : "text/html",
    tabSize        : 2, 
    lineNumbers    : true
  },
  // set sql mode to standard parser
  jsLib : {
    mysql          : { root : "cm", path : "mode/mysql/mysql.js" }  //cm is alias for codeMirrorRoot in url objects
  },
  // set search url, pluginRoot and codeMirrorRoot to alternate values
  configInfo : {
    codeMirrorRoot : "/cm/",
    pluginRoot       "/cm/ui/"
    searchUrl      : { root : "sb", path : "search.php" }  //sb is alias for pluginRoot in url objects
  }
});
</pre>

      <h4>$.fn.SiteBoxMIRROR.GetConfig(format)</h4>
      <p>
        Use this to get plugin defaults. The config object is returned as an object or JSON depending on format.
      </p>
      <pre class="docs_js">
$("#config").text($.fn.SiteBoxMIRROR.GetConfig("json"));

$("#config").text($.fn.SiteBoxMIRROR.GetConfig("object"));</pre>
      <h4>jquery.SiteBoxMirror.js Standard Config (json)</h4>
      <pre id="config"></pre>
      
      <h2>Compression helper</h2>      
      <p>
        Included in the package is a <a href="compress.htm">very simple compression helper</a> that creates 
        a standalone minified version of the current plugin config. 
        This will NOT work on your server, unless you are using siteBox, but it may help with your own solution.<br />
        see <a href="http://yuicompressor.codeplex.com/">http://yuicompressor.codeplex.com/</a>
      </p>
    
      <h2>Known Issues</h2>
      <h4>Search case-insensitive if query all lowercase</h4>
      <p>
        Search is case-insensitive when query is all-lowercase, and case-sensitive if it contains any uppercase characters.
      </p>
      
      <h4>Non IIS hosts need to change the extension of the search dialog url</h4>
      <p>
        The plugin loads its search dialogue via an ajax post. On my IIS server the extension must be a configured script type so I have used .aspx.
      </p>
      <p>
        Non IIS users can rename <a href="search.aspx">search.aspx</a> to something more appropriate and supply 
        the new name via config. This option will work with jquery.SiteBoxMirror.js and jquery.SiteBoxMirror.standalone.min.js
        because the search dialog is loaded via ajax by the plugin.<br />
        Alternatively you can edit the property <b>$.fn.SiteBoxMIRROR.configInfo.searchUrl</b> property in 
        <a href="jquery.SiteBoxMirror.js">jquery.SiteBoxMirror.js</a>
      </p>
      <h4>mySql mode is custom</h4>
      <p>
        I am using my own mysql mode that predates the one now available.<br />
        To use the standard mysql mode use the config option or change the <b>$.fn.SiteBoxMIRROR.jsLib.mysql</b> property in 
        <a href="jquery.SiteBoxMirror.js">jquery.SiteBoxMirror.js</a>. NOTE You can only use alternative modes when
         using the dynamic mode (jquery.SiteBoxMirror.js) If you want to use the standard mysql mode with
         jquery.SiteBoxMirror.standalone.min.js you will have to replace the mysql mode in the script itself.
      </p>
      
      <h4>demo css not good in ie8!!</h4>
      <p>
        The css on pre elements is screwed for ie8. Not sure why and not looking into it!
      </p>
    </div>
    <script type="text/javascript">
        $("pre.docs_htm").SiteBoxMIRROR("highlight", { mode: "text/html" });
        $("pre.docs_js").SiteBoxMIRROR("highlight", { mode: "text/javascript" });
        $("#config").text($.fn.SiteBoxMIRROR.GetConfig("json"));
        $("#config").SiteBoxMIRROR("highlight", { mode: "text/javascript" });
    </script>
    
    <div id="demo" class="box blackBox" style="max-width:1000px">
<h1 class="blackHeading">SiteBoxMirror Demo</h1> 
<div>
  <a href="#demo" class="btn" id="uiToggleBtn">destroy</a>
  <a href="#demo" class="btn" id="setBtn">setcode</a>
  <a href="#demo" class="btn" id="getBtn">getcode</a>
  
</div>
<form id="cmTest" class="cmxform" action="?" method="post" style="width:auto">
  <fieldset>
    <legend>
      SiteBoxMirror Demo
    </legend>
    <div style="max-width:980px">
      
      <label for="p_code1">html code(the demo div)</label>
      <textarea class="cmui" id="p_code1" name="p_code1" rows="10" cols="80"></textarea>
      
      <label for="p_code2">example css code</label>
      <textarea class="cmui" id="p_code2" name="p_code2" rows="10" cols="80"></textarea>
      
      <label for="p_code3">example js code</label>
      <textarea class="cmui" id="p_code3" name="p_code3" rows="10" cols="80"></textarea>
      
      <label for="p_code4">example msql code</label>
      <textarea class="cmui" id="p_code4" name="p_code4" rows="10" cols="80"></textarea>
      
    </div>
  </fieldset>
</form>

<script type="text/javascript">
  $(document).ready(function(){
    //load demo source code
    initsrc();
    
    //set up the codemirrors
    $("#p_code1").SiteBoxMIRROR({ mode: "text/html"});
    $("#p_code2").SiteBoxMIRROR({ mode: "text/css"});
    $("#p_code3").SiteBoxMIRROR({ mode: "text/javascript"});
    $("#p_code4").SiteBoxMIRROR({ mode: "text/x-mysql"}); 
    
    //toggle demo button
    $("#uiToggleBtn").click(function(){
      if($(this).text() == "destroy"){
        $("textarea.cmui").SiteBoxMIRROR("destroy");
        $(this).text("create");
      }
      else{
        $("#p_code1").SiteBoxMIRROR({ mode: "text/html"});
        $("#p_code2").SiteBoxMIRROR({ mode: "text/css"});
        $("#p_code3").SiteBoxMIRROR({ mode: "text/javascript"});
        $("#p_code4").SiteBoxMIRROR({ mode: "text/x-mysql"});
        $(this).text("destroy");
      }
      return false;
    });
    //setcode demo button
    $("#setBtn").click(function(){
      $("#p_code1").SiteBoxMIRROR("setCode", demosrc.html);
      $("#p_code2").SiteBoxMIRROR("setCode", demosrc.css);
      $("#p_code3").SiteBoxMIRROR("setCode", demosrc.js);
      $("#p_code4").SiteBoxMIRROR("setCode", demosrc.sql); 
      return false;

    });
    //getcode demo button
    $("#getBtn").click(function(){
      var code = $("textarea.cmui").SiteBoxMIRROR("getCode");
      alert(code);
      return false;
    });
  });
  
  //demo source code for editors
  var demosrc = {
    html : "",
    css : "",
    js : "",
    sql : ""
  };

  function initsrc(){
    $("#p_code1").val( jQuery.trim($("#demo").html()) );
    $("#htm-src").text($("#p_code1").val());
    $("#p_code2").val( $("#css-src").text() );
    $("#p_code3").val( $("#js-src").text() );
    $("#p_code4").val( $("#mysql-src").text() );
    
    demosrc.html = $("#htm-src").text();
    demosrc.css = $("#css-src").text();
    demosrc.js = $("#js-src").text();
    demosrc.sql = $("#mysql-src").text();
  }
</script>      
      
    </div>
       
    <pre id="htm-src" class="src"></pre>

    <pre id="css-src" class="src">
.form_rules{
  font-style=italic;
  float:right;
}

.form_errors{
  margin-bottom:10px;
  margin-left: 10px;
  border: 1px #993333 solid;
  padding:5px;
  width: 350px;
}</pre>

    <pre id="js-src" class="src">
// apply inline-box only for mozilla
if( jQuery.browser.mozilla ) {
  // do when DOM is ready
  $( function() {
    // search form, hide it, search labels to modify, filter classes nocmx and error
    $( 'form.cmxform' ).hide().find( 'p>label:not(.nocmx):not(.error)' ).each( function() {
      var $this = $(this);
      var labelContent = $this.html();
      var labelWidth = document.defaultView.getComputedStyle( this, '' ).getPropertyValue( 'width' );
      // create block element with width of label
      var labelSpan = $("&lt;span&gt;")
      .css("display", "block")
      .width(labelWidth)
      .html(labelContent);
      // change display to mozilla specific inline-box
      $this.css("display", "-moz-inline-box")
      // remove children
      .empty()
      // add span element
      .append(labelSpan);
      // show form again
    }).end().show();
  });
};</pre>

  <pre id="mysql-src" class="src">
DROP PROCEDURE IF EXISTS `rh_sp_test`$$
CREATE PROCEDURE `rh_sp_test`(
  IN SUS_ID VARCHAR(50),
  IN p_newimageName VARCHAR(128)
)
BEGIN

  DECLARE str_this_SpName VARCHAR(64);
  DECLARE int_id INT;

  SET str_this_SpName = 'rh_sp_clc_admin_pagebannerimage_NEW';

  CALL `rh_sp_sys_log_sp_call`(str_this_SpName);

  MAIN_BLOCK:BEGIN

    INSERT `rh_clc_pbi_pagebannerimage`(
      `clc_pbi_imageName`,
      `clc_pbi_status`
    )
    VALUES(
      'upload_pending.jpg',
      'INACTIVE'
    );

    SELECT LAST_INSERT_ID() INTO int_id;
  
    CALL `rh_sp_sys_SendUploadHint`(
      SUS_ID,
      'HTMLFORM',
      'p_newimageName',
      '/i/header_img/',
      'USE_ORIGINAL_FILENAME' 
    );

  END MAIN_BLOCK;
END $$
DELIMITER;</pre>

<p style="text-align:center">
  <a href="http://validator.w3.org/check?uri=referer"><img
    src="http://www.w3.org/Icons/valid-xhtml11" alt="Valid XHTML 1.1" height="31" width="88" /></a>
</p>
    
  </body>
</html>

